@using Helpio.Dashboard.Services
@inject ICurrentUserContext UserContext

<!--begin::Header-->
<nav class="app-header navbar navbar-expand bg-body">
  <!--begin::Container-->
  <div class="container-fluid">
    <!--begin::Start Navbar Links-->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-lte-toggle="sidebar" href="#" role="button">
          <i class="bi bi-list"></i>
        </a>
      </li>
      <li class="nav-item d-none d-md-block">
        <a asp-controller="Dashboard" asp-action="Index" class="nav-link">داشبورد</a>
      </li>
      <li class="nav-item d-none d-md-block">
        <a asp-controller="Tickets" asp-action="Index" class="nav-link">تیکت‌ها</a>
      </li>
      @if (UserContext.IsAdmin || UserContext.IsManager)
      {
        <li class="nav-item d-none d-md-block">
          <a asp-controller="Reports" asp-action="Index" class="nav-link">گزارشات</a>
        </li>
      }
    </ul>
    <!--end::Start Navbar Links-->
    <!--begin::End Navbar Links-->
    <ul class="navbar-nav ms-auto">
      <!--begin::Navbar Search-->
      <li class="nav-item">
        <a class="nav-link" data-widget="navbar-search" href="#" role="button">
          <i class="bi bi-search"></i>
        </a>
      </li>
      <!--end::Navbar Search-->
      
      <!--begin::Quick Actions-->
      @if (UserContext.IsAdmin || UserContext.IsManager)
      {
        <li class="nav-item dropdown">
          <a class="nav-link" data-bs-toggle="dropdown" href="#" title="عملیات سریع">
            <i class="bi bi-plus-circle"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
            <span class="dropdown-item dropdown-header">عملیات سریع</span>
            <div class="dropdown-divider"></div>
            <a asp-controller="Tickets" asp-action="Create" class="dropdown-item">
              <i class="bi bi-ticket-detailed me-2"></i> ایجاد تیکت جدید
            </a>
            <a asp-controller="Customers" asp-action="Create" class="dropdown-item">
              <i class="bi bi-person-plus me-2"></i> افزودن مشتری
            </a>
            @if (UserContext.IsAdmin)
            {
              <a asp-controller="Organizations" asp-action="Create" class="dropdown-item">
                <i class="bi bi-building me-2"></i> ایجاد سازمان
              </a>
            }
          </div>
        </li>
      }
      <!--end::Quick Actions-->
      
      <!--begin::Notifications Dropdown Menu-->
      <li class="nav-item dropdown">
        <a class="nav-link" data-bs-toggle="dropdown" href="#">
          <i class="bi bi-bell-fill"></i>
          <span class="navbar-badge badge text-bg-warning">3</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
          <span class="dropdown-item dropdown-header">3 اعلان جدید</span>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="bi bi-ticket-detailed me-2 text-info"></i> تیکت جدید اختصاص داده شد
            <span class="float-end text-secondary fs-7">5 دقیقه</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="bi bi-chat-text me-2 text-success"></i> پاسخ جدید از مشتری
            <span class="float-end text-secondary fs-7">1 ساعت</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item">
            <i class="bi bi-exclamation-triangle me-2 text-warning"></i> تیکت اولویت بالا
            <span class="float-end text-secondary fs-7">2 ساعت</span>
          </a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item dropdown-footer"> مشاهده تمام اعلان‌ها </a>
        </div>
      </li>
      <!--end::Notifications Dropdown Menu-->
      
      <!--begin::Fullscreen Toggle-->
      <li class="nav-item">
        <a class="nav-link" href="#" data-lte-toggle="fullscreen">
          <i data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i>
          <i data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none"></i>
        </a>
      </li>
      <!--end::Fullscreen Toggle-->
      
      <!--begin::User Menu Dropdown-->
      @if (User.Identity?.IsAuthenticated == true)
      {
        <li class="nav-item dropdown user-menu">
          <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
            <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center me-2" style="width: 32px; height: 32px;">
              <i class="bi bi-person text-white"></i>
            </div>
            <span class="d-none d-md-inline">@(UserContext.UserFullName ?? User.Identity.Name)</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
            <!--begin::User Image-->
            <li class="user-header text-bg-primary">
              <div class="bg-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                <i class="bi bi-person text-primary" style="font-size: 2rem;"></i>
              </div>
              <p>
                @(UserContext.UserFullName ?? User.Identity.Name)
                <small>
                  @if (UserContext.UserRoles.Any())
                  {
                    @string.Join(", ", UserContext.UserRoles)
                  }
                  else
                  {
                    <span>کاربر سیستم</span>
                  }
                </small>
              </p>
            </li>
            <!--end::User Image-->
            <!--begin::Menu Body-->
            <li class="user-body">
              <div class="row">
                <div class="col-6 text-center">
                  <a asp-controller="Profile" asp-action="Index" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-person"></i> پروفایل
                  </a>
                </div>
                <div class="col-6 text-center">
                  <a asp-controller="Profile" asp-action="Edit" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-gear"></i> تنظیمات
                  </a>
                </div>
              </div>
            </li>
            <!--end::Menu Body-->
            <!--begin::Menu Footer-->
            <li class="user-footer">
              <div class="d-grid">
                <form asp-controller="Account" asp-action="Logout" method="post">
                  <button type="submit" class="btn btn-default btn-flat w-100">
                    <i class="bi bi-box-arrow-right"></i> خروج از سیستم
                  </button>
                </form>
              </div>
            </li>
            <!--end::Menu Footer-->
          </ul>
        </li>
      }
      else
      {
        <li class="nav-item">
          <a asp-controller="Account" asp-action="Login" class="nav-link">
            <i class="bi bi-box-arrow-in-right"></i> ورود
          </a>
        </li>
      }
      <!--end::User Menu Dropdown-->
    </ul>
    <!--end::End Navbar Links-->
  </div>
  <!--end::Container-->
</nav>
<!--end::Header-->